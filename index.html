<!doctype html>
<html lang="en" class="h-full">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Digital Budget Planner</title>
  <script src="https://cdn.tailwindcss.com"></script>
 
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&amp;family=Nunito:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet">
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Nunito', sans-serif;
    }
    .heading-font {
      font-family: 'Playfair Display', serif;
    }
    .glass-card {
      background: rgba(255, 255, 255, 0.85);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.5);
    }
    .gradient-bg {
      background: linear-gradient(135deg, #f0f7f4 0%, #e8f4ec 25%, #fff9e6 50%, #fef3e2 75%, #f5f0ff 100%);
    }
    .section-gradient {
      background: linear-gradient(180deg, rgba(255,255,255,0.9) 0%, rgba(248,250,249,0.95) 100%);
    }
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type="number"] {
      -moz-appearance: textfield;
    }
    .nav-item {
      transition: all 0.3s ease;
    }
    .nav-item:hover {
      transform: translateX(4px);
    }
    .fade-in {
      animation: fadeIn 0.5s ease-out;
    }
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .pulse-gentle {
      animation: pulseGentle 3s ease-in-out infinite;
    }
    @keyframes pulseGentle {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
 </head>
 <body class="h-full gradient-bg">
  <div id="app-wrapper" class="h-full w-full overflow-auto">
   <div class="min-h-full max-w-6xl mx-auto p-4 md:p-8"><!-- Header -->
    <header class="text-center mb-8 fade-in">
     <div class="inline-block mb-4"><span class="text-5xl">üåø</span>
     </div>
     <h1 id="main-title" class="heading-font text-4xl md:text-5xl font-bold text-emerald-800 mb-3">Digital Budget Planner</h1>
     <p id="main-tagline" class="text-lg text-emerald-600 font-medium">Plan smarter. Spend intentionally. Grow confidently.</p>
    </header><!-- Navigation -->
    <nav class="glass-card rounded-2xl p-4 mb-8 fade-in">
     <div class="flex flex-wrap justify-center gap-2 md:gap-4"><button onclick="showSection('income')" class="nav-btn px-4 py-2 rounded-xl text-sm font-semibold transition-all bg-emerald-100 text-emerald-700 hover:bg-emerald-200">üí∞ Income</button> <button onclick="showSection('expenses')" class="nav-btn px-4 py-2 rounded-xl text-sm font-semibold transition-all bg-amber-100 text-amber-700 hover:bg-amber-200">üí∏ Expenses</button> <button onclick="showSection('budget')" class="nav-btn px-4 py-2 rounded-xl text-sm font-semibold transition-all bg-purple-100 text-purple-700 hover:bg-purple-200">üéØ Budget</button> <button onclick="showSection('tracker')" class="nav-btn px-4 py-2 rounded-xl text-sm font-semibold transition-all bg-rose-100 text-rose-700 hover:bg-rose-200">üìâ Tracker</button> <button onclick="showSection('savings')" class="nav-btn px-4 py-2 rounded-xl text-sm font-semibold transition-all bg-cyan-100 text-cyan-700 hover:bg-cyan-200">üíæ Savings</button> <button onclick="showSection('summary')" class="nav-btn px-4 py-2 rounded-xl text-sm font-semibold transition-all bg-indigo-100 text-indigo-700 hover:bg-indigo-200">üîÅ Summary</button> <button onclick="showSection('notes')" class="nav-btn px-4 py-2 rounded-xl text-sm font-semibold transition-all bg-pink-100 text-pink-700 hover:bg-pink-200">üß† Notes</button>
     </div>
    </nav><!-- Month Selector -->
    <div class="glass-card rounded-2xl p-4 mb-8 flex items-center justify-center gap-4 fade-in"><button onclick="changeMonth(-1)" class="p-2 rounded-lg bg-emerald-100 hover:bg-emerald-200 text-emerald-700 transition-all">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
      </svg></button> <span id="current-month" class="heading-font text-xl font-semibold text-emerald-800 min-w-48 text-center"></span> <button onclick="changeMonth(1)" class="p-2 rounded-lg bg-emerald-100 hover:bg-emerald-200 text-emerald-700 transition-all">
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
       <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
      </svg></button>
    </div><!-- Income Section -->
    <section id="section-income" class="section glass-card rounded-3xl p-6 md:p-8 mb-8 fade-in">
     <div class="flex items-center gap-3 mb-6"><span class="text-3xl">üí∞ </span>
      <h2 class="heading-font text-2xl md:text-3xl font-bold text-emerald-800">Income Overview</h2>
     </div>
     <p class="text-emerald-600 mb-6">Track every source of income ‚Äî big or small ‚Äî all in one place.</p>
     <div class="grid md:grid-cols-2 gap-6"><!-- Income Sources -->
      <div class="bg-gradient-to-br from-emerald-50 to-green-50 rounded-2xl p-5">
       <h3 class="font-bold text-emerald-800 mb-4 flex items-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
        </svg> Income Sources</h3>
       <div class="space-y-3" id="income-list"><!-- Income items rendered here -->
       </div><button onclick="openIncomeModal()" class="mt-4 w-full py-3 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white font-semibold transition-all flex items-center justify-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg> Add Income Source </button>
      </div><!-- Income Breakdown Table -->
      <div class="bg-gradient-to-br from-amber-50 to-yellow-50 rounded-2xl p-5">
       <h3 class="font-bold text-amber-800 mb-4 flex items-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" />
        </svg> Monthly Income Breakdown</h3>
       <div class="overflow-x-auto">
        <table class="w-full text-sm">
         <thead>
          <tr class="text-amber-700">
           <th class="text-left py-2">Source</th>
           <th class="text-right py-2">Expected</th>
           <th class="text-right py-2">Actual</th>
           <th class="text-right py-2">Diff</th>
          </tr>
         </thead>
         <tbody id="income-breakdown-table" class="text-amber-900"><!-- Rows rendered here -->
         </tbody>
        </table>
       </div>
       <div class="mt-4 pt-4 border-t border-amber-200">
        <div class="flex justify-between items-center font-bold text-amber-800"><span>Total Income:</span> <span id="total-income" class="text-xl">$0.00</span>
        </div>
       </div>
      </div>
     </div>
    </section>

    <!-- Expenses Section -->
    <section id="section-expenses" class="section glass-card rounded-3xl p-6 md:p-8 mb-8 hidden">
     <div class="flex items-center gap-3 mb-6"><span class="text-3xl">üí∏</span>
      <h2 class="heading-font text-2xl md:text-3xl font-bold text-amber-800">Expense Categories</h2>
     </div>
     <p class="text-amber-600 mb-6">Know exactly where your money goes. Organize spending into clear categories.</p>
      

       <button onclick="openExpenseModal()" class="mt-4 w-full py-3 rounded-xl bg-rose-600 hover:bg-rose-700 text-white font-semibold transition-all flex items-center justify-center gap-2"> 
             <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
       </svg> Add Expense </button>




     <div class="grid md:grid-cols-3 gap-6"><!-- Fixed Expenses -->
      <div class="bg-gradient-to-br from-rose-50 to-red-50 rounded-2xl p-5">
       <h3 class="font-bold text-rose-800 mb-4">üè† Fixed Expenses</h3>
       <div class="space-y-2 text-sm text-rose-700" id="fixed-expense-categories">
        <div class="flex items-center gap-2 p-2 bg-white/50 rounded-lg"><span class="w-2 h-2 rounded-full bg-rose-400"></span> Rent / Mortgage
        </div>
        <div class="flex items-center gap-2 p-2 bg-white/50 rounded-lg"><span class="w-2 h-2 rounded-full bg-rose-400"></span> Utilities
        </div>
        <div class="flex items-center gap-2 p-2 bg-white/50 rounded-lg"><span class="w-2 h-2 rounded-full bg-rose-400"></span> Internet &amp; Mobile
        </div>
        <div class="flex items-center gap-2 p-2 bg-white/50 rounded-lg"><span class="w-2 h-2 rounded-full bg-rose-400"></span> Insurance
        </div>
        <div class="flex items-center gap-2 p-2 bg-white/50 rounded-lg"><span class="w-2 h-2 rounded-full bg-rose-400"></span> Subscriptions
        </div>
        <div class="flex items-center gap-2 p-2 bg-white/50 rounded-lg"><span class="w-2 h-2 rounded-full bg-rose-400"></span> Loan Installments
        </div>
       </div>
      </div><!-- Variable Expenses -->
      <div class="bg-gradient-to-br from-orange-50 to-amber-50 rounded-2xl p-5">
       <h3 class="font-bold text-orange-800 mb-4">üõí Variable Expenses</h3>
       <div class="space-y-2 text-sm text-orange-700">
        <div class="flex items-center gap-2 p-2 bg-white/50 rounded-lg"><span class="w-2 h-2 rounded-full bg-orange-400"></span> Groceries
        </div>
        <div class="flex items-center gap-2 p-2 bg-white/50 rounded-lg"><span class="w-2 h-2 rounded-full bg-orange-400"></span> Transportation / Fuel
        </div>
        <div class="flex items-center gap-2 p-2 bg-white/50 rounded-lg"><span class="w-2 h-2 rounded-full bg-orange-400"></span> Dining &amp; Coffee
        </div>
        <div class="flex items-center gap-2 p-2 bg-white/50 rounded-lg"><span class="w-2 h-2 rounded-full bg-orange-400"></span> Shopping
        </div>
        <div class="flex items-center gap-2 p-2 bg-white/50 rounded-lg"><span class="w-2 h-2 rounded-full bg-orange-400"></span> Entertainment
        </div>
        <div class="flex items-center gap-2 p-2 bg-white/50 rounded-lg"><span class="w-2 h-2 rounded-full bg-orange-400"></span> Health &amp; Fitness
        </div>
       </div>
      </div><!-- Lifestyle & Growth -->
      <div class="bg-gradient-to-br from-purple-50 to-violet-50 rounded-2xl p-5">
       <h3 class="font-bold text-purple-800 mb-4">‚ú® Lifestyle &amp; Growth</h3>
       <div class="space-y-2 text-sm text-purple-700">
        <div class="flex items-center gap-2 p-2 bg-white/50 rounded-lg"><span class="w-2 h-2 rounded-full bg-purple-400"></span> Travel
        </div>
        <div class="flex items-center gap-2 p-2 bg-white/50 rounded-lg"><span class="w-2 h-2 rounded-full bg-purple-400"></span> Education / Courses
        </div>
        <div class="flex items-center gap-2 p-2 bg-white/50 rounded-lg"><span class="w-2 h-2 rounded-full bg-purple-400"></span> Business Expenses
        </div>
        <div class="flex items-center gap-2 p-2 bg-white/50 rounded-lg"><span class="w-2 h-2 rounded-full bg-purple-400"></span> Gifts &amp; Donations
        </div>
        <div class="flex items-center gap-2 p-2 bg-white/50 rounded-lg"><span class="w-2 h-2 rounded-full bg-purple-400"></span> Self-Care
        </div>
        <div class="flex items-center gap-2 p-2 bg-white/50 rounded-lg"><span class="w-2 h-2 rounded-full bg-purple-400"></span> Hobbies
        </div>
       </div>
      </div>
     </div>
    </section>

    <!-- Budget Section -->
    <section id="section-budget" class="section glass-card rounded-3xl p-6 md:p-8 mb-8 hidden">
     <div class="flex items-center gap-3 mb-6"><span class="text-3xl">üéØ</span>
      <h2 class="heading-font text-2xl md:text-3xl font-bold text-purple-800">Fixed Budget Setup</h2>
     </div>
     <p class="text-purple-600 mb-2">Set your limits before you spend ‚Äî not after.</p>
     <p class="text-sm text-purple-500 mb-6 italic">üí° Budget Rule Reminder: Your budget is a guide ‚Äî not a restriction.</p>
     <div class="bg-gradient-to-br from-purple-50 to-indigo-50 rounded-2xl p-5">
      <div class="overflow-x-auto">
       <table class="w-full text-sm">
        <thead>
         <tr class="text-purple-700 border-b border-purple-200">
          <th class="text-left py-3 px-2">Category</th>
          <th class="text-right py-3 px-2">Budgeted</th>
          <th class="text-right py-3 px-2">Spent</th>
          <th class="text-right py-3 px-2">Remaining</th>
          <th class="py-3 px-2 w-20"></th>
         </tr>
        </thead>
        <tbody id="budget-table" class="text-purple-900"><!-- Budget rows rendered here -->
        </tbody>
       </table>
      </div><button onclick="openBudgetModal()" class="mt-4 w-full py-3 rounded-xl bg-purple-600 hover:bg-purple-700 text-white font-semibold transition-all flex items-center justify-center gap-2">
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
       </svg> Add Budget Category </button>
     </div>
     <div class="mt-6 grid md:grid-cols-3 gap-4">
      <div class="bg-emerald-100 rounded-xl p-4 text-center">
       <p class="text-emerald-600 text-sm">Total Budgeted</p>
       <p id="total-budgeted" class="text-2xl font-bold text-emerald-800">$0.00</p>
      </div>
      <div class="bg-rose-100 rounded-xl p-4 text-center">
       <p class="text-rose-600 text-sm">Total Spent</p>
       <p id="total-spent-budget" class="text-2xl font-bold text-rose-800">$0.00</p>
      </div>
      <div class="bg-purple-100 rounded-xl p-4 text-center">
       <p class="text-purple-600 text-sm">Remaining</p>
       <p id="total-remaining" class="text-2xl font-bold text-purple-800">$0.00</p>
      </div>
     </div>
    </section>

    <!-- Expense Tracker Section -->

    <section id="section-tracker" class="section glass-card rounded-3xl p-6 md:p-8 mb-8 hidden">
     <div class="flex items-center gap-3 mb-6"><span class="text-3xl">üìâ</span>
      <h2 class="heading-font text-2xl md:text-3xl font-bold text-rose-800">Expense Tracker</h2>
     </div>
     <p class="text-rose-600 mb-6">Small expenses add up. Track them daily.</p>
     <div class="bg-gradient-to-br from-rose-50 to-pink-50 rounded-2xl p-5">
      <div class="overflow-x-auto">
       <table class="w-full text-sm">
        <thead>
         <tr class="text-rose-700 border-b border-rose-200">
          <th class="text-left py-3 px-2">Date</th>
          <th class="text-left py-3 px-2">Description</th>
          <th class="text-left py-3 px-2">Category</th>
          <th class="text-right py-3 px-2">Amount</th>
          <th class="py-3 px-2 w-20"></th>
         </tr>
        </thead>
        <tbody id="expense-tracker-table" class="text-rose-900"> <!-- Expense rows rendered here -->
        </tbody>
       </table>
      </div>
      <div class="mt-4 pt-4 border-t border-rose-200 flex justify-between items-center"><span class="font-semibold text-rose-800">Total Expenses:</span> <span id="total-tracked-expenses" class="text-xl font-bold text-rose-800">$0.00</span>
      </div>

      <button onclick="openExpenseModal()" class="mt-4 w-full py-3 rounded-xl bg-rose-600 hover:bg-rose-700 text-white font-semibold transition-all flex items-center justify-center gap-2"> 
       <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
       </svg> Add Expense </button>

     </div>
    </section>

    <!-- Savings Section -->

    <section id="section-savings" class="section glass-card rounded-3xl p-6 md:p-8 mb-8 hidden">
     <div class="flex items-center gap-3 mb-6"><span class="text-3xl">üíæ</span>
      <h2 class="heading-font text-2xl md:text-3xl font-bold text-cyan-800">Savings &amp; Goals</h2>
     </div>
     <p class="text-cyan-600 mb-6">Pay yourself first. Build your future.</p>
     <div class="grid md:grid-cols-2 gap-6"><!-- Savings Buckets -->
      <div class="bg-gradient-to-br from-cyan-50 to-teal-50 rounded-2xl p-5">
       <h3 class="font-bold text-cyan-800 mb-4">ü™£ Savings Buckets</h3>
       <div class="space-y-3">
        <div class="flex items-center gap-3 p-3 bg-white/60 rounded-xl"><span class="text-2xl">üÜò</span> <span class="text-cyan-700 font-medium">Emergency Fund</span>
        </div>
        <div class="flex items-center gap-3 p-3 bg-white/60 rounded-xl"><span class="text-2xl">‚úàÔ∏è</span> <span class="text-cyan-700 font-medium">Travel Fund</span>
        </div>
        <div class="flex items-center gap-3 p-3 bg-white/60 rounded-xl"><span class="text-2xl">üìà</span> <span class="text-cyan-700 font-medium">Investment</span>
        </div>
        <div class="flex items-center gap-3 p-3 bg-white/60 rounded-xl"><span class="text-2xl">üéÅ</span> <span class="text-cyan-700 font-medium">Big Purchase</span>
        </div>
        <div class="flex items-center gap-3 p-3 bg-white/60 rounded-xl"><span class="text-2xl">üåü</span> <span class="text-cyan-700 font-medium">Future Goals</span>
        </div>
       </div>
      </div>

      <!-- Goals Tracker -->

      <div class="bg-gradient-to-br from-teal-50 to-emerald-50 rounded-2xl p-5">
       <h3 class="font-bold text-teal-800 mb-4">üéØ Goals Tracker</h3>
       <div class="overflow-x-auto">
        <table class="w-full text-sm">
         <thead>
          <tr class="text-teal-700 border-b border-teal-200">
           <th class="text-left py-2">Goal</th>
           <th class="text-right py-2">Target</th>
           <th class="text-right py-2">Saved</th>
           <th class="py-2 w-16"></th>
          </tr>
         </thead>
         <tbody id="savings-goals-table" class="text-teal-900"><!-- Goals rendered here -->
         </tbody>
        </table>
       </div><button onclick="openSavingsModal()" class="mt-4 w-full py-3 rounded-xl bg-teal-600 hover:bg-teal-700 text-white font-semibold transition-all flex items-center justify-center gap-2">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewbox="0 0 24 24">
         <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
        </svg> Add Savings Goal </button>
      </div>
     </div>
     <div class="mt-6 bg-gradient-to-r from-cyan-100 to-teal-100 rounded-xl p-4">
      <div class="flex justify-between items-center"><span class="font-semibold text-cyan-800">Total Savings Progress:</span> <span id="total-savings" class="text-xl font-bold text-cyan-800">$0.00</span>
      </div>
     </div>
    </section><!-- Summary Section -->
    <section id="section-summary" class="section glass-card rounded-3xl p-6 md:p-8 mb-8 hidden">
     <div class="flex items-center gap-3 mb-6"><span class="text-3xl">üîÅ</span>
      <h2 class="heading-font text-2xl md:text-3xl font-bold text-indigo-800">Monthly Summary</h2>
     </div>
     <p class="text-indigo-600 mb-6">Reflect. Adjust. Improve.</p>
     <div class="grid md:grid-cols-3 gap-4 mb-6">
      <div class="bg-gradient-to-br from-emerald-100 to-green-100 rounded-2xl p-6 text-center">
       <p class="text-emerald-600 text-sm mb-1">Total Income</p>
       <p id="summary-income" class="text-3xl font-bold text-emerald-800">$0.00</p>
      </div>
      <div class="bg-gradient-to-br from-rose-100 to-red-100 rounded-2xl p-6 text-center">
       <p class="text-rose-600 text-sm mb-1">Total Expenses</p>
       <p id="summary-expenses" class="text-3xl font-bold text-rose-800">$0.00</p>
      </div>
      <div class="bg-gradient-to-br from-indigo-100 to-purple-100 rounded-2xl p-6 text-center">
       <p class="text-indigo-600 text-sm mb-1">Savings / Surplus</p>
       <p id="summary-surplus" class="text-3xl font-bold text-indigo-800">$0.00</p>
      </div>
     </div>
     <div class="grid md:grid-cols-2 gap-6">
      <div class="bg-gradient-to-br from-amber-50 to-orange-50 rounded-2xl p-5">
       <h3 class="font-bold text-amber-800 mb-3">‚ö†Ô∏è Overspent Areas</h3>
       <div id="overspent-areas" class="text-amber-700 space-y-2">
        <p class="text-sm italic">No overspent categories this month!</p>
       </div>
      </div>
      <div class="bg-gradient-to-br from-emerald-50 to-teal-50 rounded-2xl p-5">
       <h3 class="font-bold text-emerald-800 mb-3">üèÜ Wins This Month</h3>
       <div id="monthly-wins" class="text-emerald-700 space-y-2">
        <p class="text-sm italic">Keep tracking to see your wins!</p>
       </div>
      </div>
     </div>
    </section><!-- Notes Section -->
    <section id="section-notes" class="section glass-card rounded-3xl p-6 md:p-8 mb-8 hidden">
     <div class="flex items-center gap-3 mb-6"><span class="text-3xl">üß†</span>
      <h2 class="heading-font text-2xl md:text-3xl font-bold text-pink-800">Notes &amp; Reflection</h2>
     </div>
     <p class="text-pink-600 mb-6">Money is emotional ‚Äî reflection creates balance.</p>
     <div class="bg-gradient-to-br from-pink-50 to-rose-50 rounded-2xl p-5 mb-6"><label class="block text-pink-800 font-semibold mb-3">Use this space to write:</label>
      <ul class="text-pink-600 text-sm mb-4 space-y-1">
       <li>‚Ä¢ Spending habits you noticed</li>
       <li>‚Ä¢ What worked well</li>
       <li>‚Ä¢ What you want to improve next month</li>
      </ul><textarea id="monthly-notes" rows="6" class="w-full p-4 rounded-xl border-2 border-pink-200 focus:border-pink-400 focus:outline-none resize-none text-pink-900" placeholder="Write your reflections here..."></textarea> <button onclick="saveNotes()" id="save-notes-btn" class="mt-3 px-6 py-2 rounded-xl bg-pink-600 hover:bg-pink-700 text-white font-semibold transition-all"> Save Notes </button>
     </div><!-- Affirmation Page -->
     <div class="bg-gradient-to-br from-violet-100 to-purple-100 rounded-2xl p-6 text-center">
      <h3 class="heading-font text-xl font-bold text-violet-800 mb-4">‚ú® Daily Affirmations</h3>
      <div class="space-y-3">
       <p id="affirmation-1" class="text-violet-700 italic text-lg">"I manage my money with clarity and confidence."</p>
       <p id="affirmation-2" class="text-violet-700 italic text-lg">"Every dollar has a purpose."</p>
       <p id="affirmation-3" class="text-violet-700 italic text-lg">"I am building a secure and abundant future."</p>
      </div>
     </div>
    </section><!-- Footer -->
    <footer class="text-center py-6 text-emerald-600 text-sm">
     <p class="pulse-gentle">üåø Your journey to financial wellness starts here üåø</p>
    </footer>
   </div>
  </div><!-- Modals -->
  <div id="modal-overlay" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
   <div id="modal-content" class="bg-white rounded-2xl p-6 w-full max-w-md max-h-[90%] overflow-y-auto"><!-- Modal content inserted dynamically -->
   </div>
  </div><!-- Delete Confirmation -->
  <div id="delete-confirm" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4">
   <div class="bg-white rounded-2xl p-6 w-full max-w-sm text-center">
    <p class="text-lg font-semibold text-gray-800 mb-4">Are you sure you want to delete this item?</p>
    <div class="flex gap-3 justify-center"><button onclick="cancelDelete()" class="px-6 py-2 rounded-xl bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold transition-all">Cancel</button> <button onclick="confirmDelete()" id="confirm-delete-btn" class="px-6 py-2 rounded-xl bg-rose-600 hover:bg-rose-700 text-white font-semibold transition-all">Delete</button>
    </div>
   </div>
  </div><!-- Toast -->
  <div id="toast" class="fixed bottom-4 right-4 bg-emerald-600 text-white px-6 py-3 rounded-xl shadow-lg transform translate-y-20 opacity-0 transition-all duration-300 z-50"><span id="toast-message"></span>
  </div>
  <script>
    // Default configuration
    const defaultConfig = {
      planner_title: 'Digital Budget Planner',
      tagline: 'Plan smarter. Spend intentionally. Grow confidently.',
      affirmation_one: 'I manage my money with clarity and confidence.',
      affirmation_two: 'Every dollar has a purpose.',
      affirmation_three: 'I am building a secure and abundant future.',
      primary_color: '#047857',
      secondary_color: '#f0fdf4',
      accent_color: '#d97706',
      text_color: '#1f2937',
      font_family: 'Nunito'
    };

    // App State
    let allData = [];
    let currentMonth = new Date();
    let pendingDeleteItem = null;
    let isLoading = false;

    // Expense categories for dropdowns
    const expenseCategories = [
      'Rent / Mortgage', 'Utilities', 'Internet & Mobile', 'Insurance', 'Subscriptions', 'Loan Installments',
      'Groceries', 'Transportation / Fuel', 'Dining & Coffee', 'Shopping', 'Entertainment', 'Health & Fitness',
      'Travel', 'Education / Courses', 'Business Expenses', 'Gifts & Donations', 'Self-Care', 'Hobbies', 'Other'
    ];

    // Income sources for dropdowns
    const incomeSources = [
      'Primary Salary / Job', 'Business Income', 'Freelance / Consulting', 'Online Sales / Digital Products',
      'Rental Income', 'Investments / Dividends', 'Side Hustles', 'Other Income'
    ];


    /* 1Ô∏è‚É£  PASTE YOUR PERSONAL GOOGLE-SCRIPT URL ONCE               */
      /*     (you can store it in localStorage or ask the user once)   */
      const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyEuCzs1X4O8TFOr-QK03c1yjgTTFp0TgEGgAIEVJQ9ri_IB-kxDY5zmOcikBDatLK38w/exec'

      /*localStorage.getItem('personalScriptUrl') ||
                                prompt('Paste your private Google-Script URL (from the PDF):');*/

      if (!GOOGLE_SCRIPT_URL) throw new Error('Google-Script URL required');
      localStorage.setItem('personalScriptUrl', GOOGLE_SCRIPT_URL);

       // Data Handler for Data SDK
    const dataHandler = {
      onDataChanged(data) {
        allData = data;
        renderAll();
      }
    };

    // Initialize Data SDK
    async function initDataSdk() {
      if (window.dataSdk) {
        const result = await window.dataSdk.init(dataHandler);
        if (!result.isOk) {
          showToast('Failed to initialize data storage', 'error');
        }
      }
    }

    // Utility Functions
    function getMonthKey(date) {
      return `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}`;
    }

    function formatMonth(date) {
      return date.toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
    }

    function formatCurrency(amount) {
      return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(amount || 0);
    }

    function showSection(sectionName) {
      document.querySelectorAll('.section').forEach(s => s.classList.add('hidden'));
      document.getElementById(`section-${sectionName}`).classList.remove('hidden');
    }

    function changeMonth(direction) {
      currentMonth.setMonth(currentMonth.getMonth() + direction);
      document.getElementById('current-month').textContent = formatMonth(currentMonth);
      renderAll();
    }

    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      const toastMessage = document.getElementById('toast-message');
      toastMessage.textContent = message;
      toast.className = `fixed bottom-4 right-4 px-6 py-3 rounded-xl shadow-lg transform transition-all duration-300 z-50 ${type === 'error' ? 'bg-rose-600' : 'bg-emerald-600'} text-white`;
      toast.classList.remove('translate-y-20', 'opacity-0');
      setTimeout(() => {
        toast.classList.add('translate-y-20', 'opacity-0');
      }, 3000);
    }

    function closeModal() {
      document.getElementById('modal-overlay').classList.add('hidden');
    }

    function showModal(content) {
      document.getElementById('modal-content').innerHTML = content;
      document.getElementById('modal-overlay').classList.remove('hidden');
    }

    // Filter data by current month and type
    function filterData(type) {
      const monthKey = getMonthKey(currentMonth);
      return allData.filter(item => item.type === type && item.month === monthKey);
    }

    // Render Functions
    function renderAll() {
      renderIncome();
      renderBudget();
      renderExpenses();
      renderSavings();
      renderSummary();
      renderNotes();
    }

    function renderIncome() {
      const incomeData = filterData('income');
      const incomeList = document.getElementById('income-list');
      const incomeTable = document.getElementById('income-breakdown-table');
      
      if (incomeData.length === 0) {
        incomeList.innerHTML = '<p class="text-emerald-500 text-sm italic">No income sources added yet.</p>';
        incomeTable.innerHTML = '<tr><td colspan="4" class="py-4 text-center text-amber-500 italic">Add income sources to see breakdown</td></tr>';
        document.getElementById('total-income').textContent = formatCurrency(0);
        return;
      }

      let totalActual = 0;
      
      incomeList.innerHTML = incomeData.map(item => {
        totalActual += item.actual || 0;
        return `
          <div class="flex items-center justify-between p-3 bg-white/60 rounded-xl group" data-id="${item.__backendId}">
            <div>
              <p class="font-medium text-emerald-800">${item.name}</p>
              <p class="text-sm text-emerald-600">${formatCurrency(item.actual)}</p>
            </div>
            <button onclick="deleteItem('${item.__backendId}')" class="p-2 text-rose-500 hover:bg-rose-100 rounded-lg opacity-0 group-hover:opacity-100 transition-all">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
            </button>
          </div>
        `;
      }).join('');

      incomeTable.innerHTML = incomeData.map(item => {
        const diff = (item.actual || 0) - (item.expected || 0);
        const diffClass = diff >= 0 ? 'text-emerald-600' : 'text-rose-600';
        return `
          <tr class="border-b border-amber-100">
            <td class="py-2 px-2">${item.name}</td>
            <td class="py-2 px-2 text-right">${formatCurrency(item.expected)}</td>
            <td class="py-2 px-2 text-right">${formatCurrency(item.actual)}</td>
            <td class="py-2 px-2 text-right ${diffClass}">${diff >= 0 ? '+' : ''}${formatCurrency(diff)}</td>
          </tr>
        `;
      }).join('');

      document.getElementById('total-income').textContent = formatCurrency(totalActual);
    }

    function renderBudget() {
      const budgetData = filterData('budget');
      const budgetTable = document.getElementById('budget-table');
      
      if (budgetData.length === 0) {
        budgetTable.innerHTML = '<tr><td colspan="5" class="py-8 text-center text-purple-500 italic">No budget categories set up yet.</td></tr>';
        document.getElementById('total-budgeted').textContent = formatCurrency(0);
        document.getElementById('total-spent-budget').textContent = formatCurrency(0);
        document.getElementById('total-remaining').textContent = formatCurrency(0);
        return;
      }

      let totalBudgeted = 0, totalSpent = 0;

      budgetTable.innerHTML = budgetData.map(item => {
        const budgeted = item.budgeted || 0;
        const spent = item.spent || 0;
        const remaining = budgeted - spent;
        totalBudgeted += budgeted;
        totalSpent += spent;
        
        const progressPercent = budgeted > 0 ? Math.min((spent / budgeted) * 100, 100) : 0;
        const progressColor = progressPercent > 90 ? 'bg-rose-500' : progressPercent > 70 ? 'bg-amber-500' : 'bg-emerald-500';
        
        return `
          <tr class="border-b border-purple-100 group">
            <td class="py-3 px-2">
              <div>${item.category}</div>
              <div class="w-full h-2 bg-purple-100 rounded-full mt-1">
                <div class="${progressColor} h-2 rounded-full transition-all" style="width: ${progressPercent}%"></div>
              </div>
            </td>
            <td class="py-3 px-2 text-right">${formatCurrency(budgeted)}</td>
            <td class="py-3 px-2 text-right">${formatCurrency(spent)}</td>
            <td class="py-3 px-2 text-right ${remaining < 0 ? 'text-rose-600' : 'text-emerald-600'}">${formatCurrency(remaining)}</td>
            <td class="py-3 px-2">
              <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-all">
                <button onclick="editBudget('${item.__backendId}')" class="p-1 text-purple-500 hover:bg-purple-100 rounded">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/></svg>
                </button>
                <button onclick="deleteItem('${item.__backendId}')" class="p-1 text-rose-500 hover:bg-rose-100 rounded">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                </button>
              </div>
            </td>
          </tr>
        `;
      }).join('');

      document.getElementById('total-budgeted').textContent = formatCurrency(totalBudgeted);
      document.getElementById('total-spent-budget').textContent = formatCurrency(totalSpent);
      document.getElementById('total-remaining').textContent = formatCurrency(totalBudgeted - totalSpent);
    }

    function renderExpenses() {
      const expenseData = filterData('expense');
      const expenseTable = document.getElementById('expense-tracker-table');
      
      if (expenseData.length === 0) {
        expenseTable.innerHTML = '<tr><td colspan="5" class="py-8 text-center text-rose-500 italic">No expenses tracked yet.</td></tr>';
        document.getElementById('total-tracked-expenses').textContent = formatCurrency(0);
        return;
      }

      let totalExpenses = 0;
      
      // Sort by date descending
      const sortedExpenses = [...expenseData].sort((a, b) => new Date(b.date) - new Date(a.date));

      expenseTable.innerHTML = sortedExpenses.map(item => {
        totalExpenses += item.amount || 0;
        return `
          <tr class="border-b border-rose-100 group">
            <td class="py-3 px-2">${new Date(item.date).toLocaleDateString()}</td>
            <td class="py-3 px-2">${item.description}</td>
            <td class="py-3 px-2">
              <span class="px-2 py-1 bg-rose-100 text-rose-700 rounded-full text-xs">${item.category}</span>
            </td>
            <td class="py-3 px-2 text-right font-medium">${formatCurrency(item.amount)}</td>
            <td class="py-3 px-2">
              <button onclick="deleteItem('${item.__backendId}')" class="p-1 text-rose-500 hover:bg-rose-100 rounded opacity-0 group-hover:opacity-100 transition-all">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
              </button>
            </td>
          </tr>
        `;
      }).join('');

      document.getElementById('total-tracked-expenses').textContent = formatCurrency(totalExpenses);
    }

    function renderSavings() {
      const savingsData = filterData('savings');
      const savingsTable = document.getElementById('savings-goals-table');
      
      if (savingsData.length === 0) {
        savingsTable.innerHTML = '<tr><td colspan="4" class="py-8 text-center text-teal-500 italic">No savings goals set yet.</td></tr>';
        document.getElementById('total-savings').textContent = formatCurrency(0);
        return;
      }

      let totalSaved = 0;

      savingsTable.innerHTML = savingsData.map(item => {
        totalSaved += item.saved || 0;
        const progress = item.target > 0 ? Math.min((item.saved / item.target) * 100, 100) : 0;
        
        return `
          <tr class="border-b border-teal-100 group">
            <td class="py-3">
              <div>${item.name}</div>
              <div class="w-full h-2 bg-teal-100 rounded-full mt-1">
                <div class="bg-teal-500 h-2 rounded-full transition-all" style="width: ${progress}%"></div>
              </div>
            </td>
            <td class="py-3 text-right">${formatCurrency(item.target)}</td>
            <td class="py-3 text-right text-teal-600 font-medium">${formatCurrency(item.saved)}</td>
            <td class="py-3">
              <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-all">
                <button onclick="editSavings('${item.__backendId}')" class="p-1 text-teal-500 hover:bg-teal-100 rounded">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/></svg>
                </button>
                <button onclick="deleteItem('${item.__backendId}')" class="p-1 text-rose-500 hover:bg-rose-100 rounded">
                  <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/></svg>
                </button>
              </div>
            </td>
          </tr>
        `;
      }).join('');

      document.getElementById('total-savings').textContent = formatCurrency(totalSaved);
    }

    function renderSummary() {
      const incomeData = filterData('income');
      const expenseData = filterData('expense');
      const budgetData = filterData('budget');
      
      const totalIncome = incomeData.reduce((sum, item) => sum + (item.actual || 0), 0);
      const totalExpenses = expenseData.reduce((sum, item) => sum + (item.amount || 0), 0);
      const surplus = totalIncome - totalExpenses;

      document.getElementById('summary-income').textContent = formatCurrency(totalIncome);
      document.getElementById('summary-expenses').textContent = formatCurrency(totalExpenses);
      document.getElementById('summary-surplus').textContent = formatCurrency(surplus);
      document.getElementById('summary-surplus').className = `text-3xl font-bold ${surplus >= 0 ? 'text-indigo-800' : 'text-rose-800'}`;

      // Overspent areas
      const overspentAreas = budgetData.filter(item => (item.spent || 0) > (item.budgeted || 0));
      const overspentDiv = document.getElementById('overspent-areas');
      if (overspentAreas.length > 0) {
        overspentDiv.innerHTML = overspentAreas.map(item => `
          <div class="flex justify-between items-center p-2 bg-amber-100 rounded-lg">
            <span>${item.category}</span>
            <span class="font-semibold text-rose-600">${formatCurrency((item.spent || 0) - (item.budgeted || 0))} over</span>
          </div>
        `).join('');
      } else {
        overspentDiv.innerHTML = '<p class="text-sm italic">No overspent categories this month! üéâ</p>';
      }

      // Monthly wins
      const winsDiv = document.getElementById('monthly-wins');
      const wins = [];
      if (surplus > 0) wins.push(`Saved ${formatCurrency(surplus)} this month!`);
      const underBudget = budgetData.filter(item => (item.spent || 0) < (item.budgeted || 0) * 0.8);
      if (underBudget.length > 0) wins.push(`Stayed well under budget in ${underBudget.length} categories`);
      if (incomeData.length > 0) wins.push(`Tracked ${incomeData.length} income sources`);
      
      if (wins.length > 0) {
        winsDiv.innerHTML = wins.map(win => `
          <div class="flex items-center gap-2 p-2 bg-emerald-100 rounded-lg">
            <span class="text-emerald-600">‚úì</span>
            <span>${win}</span>
          </div>
        `).join('');
      } else {
        winsDiv.innerHTML = '<p class="text-sm italic">Keep tracking to see your wins!</p>';
      }
    }

    function renderNotes() {
      const notesData = allData.filter(item => item.type === 'notes' && item.month === getMonthKey(currentMonth));
      const notesTextarea = document.getElementById('monthly-notes');
      if (notesData.length > 0) {
        notesTextarea.value = notesData[0].notes || '';
      } else {
        notesTextarea.value = '';
      }
    }

    // Modal Functions
    function openIncomeModal() {
      const options = incomeSources.map(s => `<option value="${s}">${s}</option>`).join('');
      showModal(`
        <h3 class="heading-font text-xl font-bold text-emerald-800 mb-4">Add Income Source</h3>
        <form onsubmit="saveIncome(event)">
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-emerald-700 mb-1">Income Source</label>
              <select id="income-source" required class="w-full p-3 rounded-xl border-2 border-emerald-200 focus:border-emerald-400 focus:outline-none">
                <option value="">Select source...</option>
                ${options}
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-emerald-700 mb-1">Expected Amount</label>
              <input type="number" id="income-expected" step="0.01" min="0" required class="w-full p-3 rounded-xl border-2 border-emerald-200 focus:border-emerald-400 focus:outline-none" placeholder="0.00">
            </div>
            <div>
              <label class="block text-sm font-medium text-emerald-700 mb-1">Actual Amount</label>
              <input type="number" id="income-actual" step="0.01" min="0" required class="w-full p-3 rounded-xl border-2 border-emerald-200 focus:border-emerald-400 focus:outline-none" placeholder="0.00">
            </div>
          </div>
          <div class="flex gap-3 mt-6">
            <button type="button" onclick="closeModal()" class="flex-1 py-3 rounded-xl bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold transition-all">Cancel</button>
            <button type="submit" id="save-income-btn" class="flex-1 py-3 rounded-xl bg-emerald-600 hover:bg-emerald-700 text-white font-semibold transition-all">Save</button>
          </div>
        </form>
      `);
    }



    async function loadFromGoogleSheet() {
  const res  = await fetch(GOOGLE_SCRIPT_URL);
  const rows = await res.json();          // array of objects from doGet()
  allData = rows.map(r => ({
    type: r.Type,
    name: r.Name,
    category: r.Category,
    amount: parseFloat(r.Amount || 0),
    date: r.Date,
    month: r.Month,
    notes: r.Notes,
    createdAt: r.CreatedAt,
    __backendId: r.CreatedAt             // cheap unique key
  }));
  renderAll();
}

       /*  2Ô∏è‚É£  NEW saveIncome ‚Äî NO Canva SDK ****************************/
    async function saveIncome(e) {
      e.preventDefault();
      if (isLoading) return;                 // 999 limit removed ‚Äî Sheets can handle > 999 rows

      isLoading = true;
      const btn = document.getElementById('save-income-btn');
      btn.textContent = 'Saving...';
      btn.disabled = true;

      // build the exact JSON your doPost() expects
      const payload = {
        type: 'income',
        name: document.getElementById('income-source').value,
        expected: parseFloat(document.getElementById('income-expected').value) || 0,
        actual:   parseFloat(document.getElementById('income-actual').value)   || 0,
        month: getMonthKey(currentMonth),
        createdAt: new Date().toISOString()
      };

      try {
        const res = await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify(payload),
          headers: { 'Content-Type': 'application/json' }
        });

        const answer = await res.json();
        if (answer.status === 'ok') {
          showToast('Income added successfully!');
          closeModal();
          await loadFromGoogleSheet();   // refresh local allData array
        } else {
          throw new Error(answer.message || 'Server error');
        }
      } catch (err) {
        console.error(err);
        showToast('Failed to save income', 'error');
        btn.textContent = 'Save';
        btn.disabled = false;
      } finally {
        isLoading = false;
      }
    }

     

    function openBudgetModal(editId = null) {
      const item = editId ? allData.find(d => d.__backendId === editId) : null;
      const options = expenseCategories.map(c => `<option value="${c}" ${item && item.category === c ? 'selected' : ''}>${c}</option>`).join('');
      
      showModal(`
        <h3 class="heading-font text-xl font-bold text-purple-800 mb-4">${editId ? 'Edit' : 'Add'} Budget Category</h3>
        <form onsubmit="saveBudget(event, '${editId || ''}')">
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-purple-700 mb-1">Category</label>
              <select id="budget-category" required class="w-full p-3 rounded-xl border-2 border-purple-200 focus:border-purple-400 focus:outline-none" ${editId ? 'disabled' : ''}>
                <option value="">Select category...</option>
                ${options}
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-purple-700 mb-1">Budgeted Amount</label>
              <input type="number" id="budget-amount" step="0.01" min="0" required value="${item ? item.budgeted : ''}" class="w-full p-3 rounded-xl border-2 border-purple-200 focus:border-purple-400 focus:outline-none" placeholder="0.00">
            </div>
            <div>
              <label class="block text-sm font-medium text-purple-700 mb-1">Amount Spent</label>
              <input type="number" id="budget-spent" step="0.01" min="0" value="${item ? item.spent : '0'}" class="w-full p-3 rounded-xl border-2 border-purple-200 focus:border-purple-400 focus:outline-none" placeholder="0.00">
            </div>
          </div>
          <div class="flex gap-3 mt-6">
            <button type="button" onclick="closeModal()" class="flex-1 py-3 rounded-xl bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold transition-all">Cancel</button>
            <button type="submit" id="save-budget-btn" class="flex-1 py-3 rounded-xl bg-purple-600 hover:bg-purple-700 text-white font-semibold transition-all">Save</button>
          </div>
        </form>
      `);
    }

 
    function editBudget(id) {
      openBudgetModal(id);
    }

  async function saveBudget(e, editId = '') {
  e.preventDefault();
  if (isLoading) return;

  isLoading = true;
  const btn = document.getElementById('save-budget-btn');
  btn.textContent = 'Saving...';
  btn.disabled = true;

  // build payload
  const payload = {
    type: 'budget',
    category: document.getElementById('budget-category').value,
    budgeted: parseFloat(document.getElementById('budget-amount').value) || 0,
    spent:    parseFloat(document.getElementById('budget-spent').value)  || 0,
    month: getMonthKey(currentMonth),
    createdAt: editId || new Date().toISOString()   // reuse CreatedAt as cheap UID
  };

  // If we are editing we first delete the old row (simple way: skip duplicate key in Sheets)
  // For now we just append the new values ‚Äì Google Sheets will keep both rows;
  // you can enhance doPost() to overwrite on matching (type,month,category) if you prefer.

  try {
    const res = await fetch(GOOGLE_SCRIPT_URL, {
      method: 'POST',
      body: JSON.stringify(payload),
      headers: { 'Content-Type': 'application/json' }
    });

    const answer = await res.json();
    if (answer.status === 'ok') {
      showToast('Budget saved successfully!');
      closeModal();
      await loadFromGoogleSheet();   // refresh tables
    } else {
      throw new Error(answer.message || 'Server error');
    }
  } catch (err) {
    console.error(err);
    showToast('Failed to save budget', 'error');
    btn.textContent = 'Save';
    btn.disabled = false;
  } finally {
    isLoading = false;
  }
}

    function openExpenseModal() {
      const options = expenseCategories.map(c => `<option value="${c}">${c}</option>`).join('');
      const today = new Date().toISOString().split('T')[0];
      
      showModal(`
        <h3 class="heading-font text-xl font-bold text-rose-800 mb-4">Add Expense</h3>
        <form onsubmit="saveExpense(event)">
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-rose-700 mb-1">Date</label>
              <input type="date" id="expense-date" required value="${today}" class="w-full p-3 rounded-xl border-2 border-rose-200 focus:border-rose-400 focus:outline-none">
            </div>
            <div>
              <label class="block text-sm font-medium text-rose-700 mb-1">Description</label>
              <input type="text" id="expense-description" required class="w-full p-3 rounded-xl border-2 border-rose-200 focus:border-rose-400 focus:outline-none" placeholder="What did you spend on?">
            </div>
            <div>
              <label class="block text-sm font-medium text-rose-700 mb-1">Category</label>
              <select id="expense-category" required class="w-full p-3 rounded-xl border-2 border-rose-200 focus:border-rose-400 focus:outline-none">
                <option value="">Select category...</option>
                ${options}
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-rose-700 mb-1">Amount</label>
              <input type="number" id="expense-amount" step="0.01" min="0" required class="w-full p-3 rounded-xl border-2 border-rose-200 focus:border-rose-400 focus:outline-none" placeholder="0.00">
            </div>
          </div>
          <div class="flex gap-3 mt-6">
            <button type="button" onclick="closeModal()" class="flex-1 py-3 rounded-xl bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold transition-all">Cancel</button>
            <button type="submit" id="save-expense-btn" class="flex-1 py-3 rounded-xl bg-rose-600 hover:bg-rose-700 text-white font-semibold transition-all">Save</button>
          </div>
        </form>
      `);
    }


   
   async function saveExpense(e) {
  e.preventDefault();
  if (isLoading) return;          // 999 limit removed ‚Äì Sheets handles > 999 rows

  isLoading = true;
  const btn = document.getElementById('save-expense-btn');
  btn.textContent = 'Saving...';
  btn.disabled = true;

  const expenseDate = new Date(document.getElementById('expense-date').value);
  const expenseMonth = getMonthKey(expenseDate);

  // Build payload
  const payload = {
    type: 'expense',
    date: document.getElementById('expense-date').value,
    description: document.getElementById('expense-description').value,
    category: document.getElementById('expense-category').value,
    amount: parseFloat(document.getElementById('expense-amount').value) || 0,
    month: expenseMonth,
    createdAt: new Date().toISOString()
  };

  try {
    // 1. save the expense row
    const res = await fetch(GOOGLE_SCRIPT_URL, {
      method: 'POST',
      body: JSON.stringify(payload),
      headers: { 'Content-Type': 'application/json' }
    });
    const answer = await res.json();
    if (answer.status !== 'ok') throw new Error(answer.message || 'Server error');

    // 2. auto-update budget ‚Äúspent‚Äù for this category
    await updateBudgetSpent(payload.category, payload.amount, expenseMonth);

    showToast('Expense added successfully!');
    closeModal();
    await loadFromGoogleSheet(); // refresh tables
  } catch (err) {
    console.error(err);
    showToast('Failed to save expense', 'error');
    btn.textContent = 'Save';
    btn.disabled = false;
  } finally {
    isLoading = false;
  }
}

            async function updateBudgetSpent(category, amount, month) {
        // find the existing budget row for this category/month
        const budgetItem = allData.find(d => d.type === 'budget' && d.category === category && d.month === month);
        if (!budgetItem) return;          // no budget set, nothing to update

        // build updated payload (keep same key so Sheets can overwrite if you enhance doPost)
        const updated = {
          ...budgetItem,
          spent: (budgetItem.spent || 0) + amount
        };

        // send to Google Sheets
        try {
          const res = await fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(updated),
            headers: { 'Content-Type': 'application/json' }
          });
          const ans = await res.json();
          if (ans.status !== 'ok') throw new Error(ans.message || 'Server error');
        } catch (err) {
          console.error('Could not update budget spent:', err);
        }
      }

    function openSavingsModal() {
      showModal(`
        <h3 class="heading-font text-xl font-bold text-teal-800 mb-4">Add Savings Goal</h3>
        <form onsubmit="saveSavingsGoal(event)">
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-teal-700 mb-1">Goal Name</label>
              <input type="text" id="savings-name" required class="w-full p-3 rounded-xl border-2 border-teal-200 focus:border-teal-400 focus:outline-none" placeholder="e.g., Emergency Fund">
            </div>
            <div>
              <label class="block text-sm font-medium text-teal-700 mb-1">Target Amount</label>
              <input type="number" id="savings-target" step="0.01" min="0" required class="w-full p-3 rounded-xl border-2 border-teal-200 focus:border-teal-400 focus:outline-none" placeholder="0.00">
            </div>
            <div>
              <label class="block text-sm font-medium text-teal-700 mb-1">Amount Saved So Far</label>
              <input type="number" id="savings-saved" step="0.01" min="0" value="0" class="w-full p-3 rounded-xl border-2 border-teal-200 focus:border-teal-400 focus:outline-none" placeholder="0.00">
            </div>
          </div>
          <div class="flex gap-3 mt-6">
            <button type="button" onclick="closeModal()" class="flex-1 py-3 rounded-xl bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold transition-all">Cancel</button>
            <button type="submit" id="save-savings-btn" class="flex-1 py-3 rounded-xl bg-teal-600 hover:bg-teal-700 text-white font-semibold transition-all">Save</button>
          </div>
        </form>
      `);
    }


    
        async function saveSavingsGoal(e) {
      e.preventDefault();
      if (isLoading) return;          // 999 limit removed ‚Äì Sheets handles > 999 rows

      isLoading = true;
      const btn = document.getElementById('save-savings-btn');
      btn.textContent = 'Saving...';
      btn.disabled = true;

      // Build payload
      const payload = {
        type: 'savings',
        name: document.getElementById('savings-name').value,
        target: parseFloat(document.getElementById('savings-target').value) || 0,
        saved:  parseFloat(document.getElementById('savings-saved').value)  || 0,
        month: getMonthKey(currentMonth),
        createdAt: new Date().toISOString()
      };

      try {
        const res = await fetch(GOOGLE_SCRIPT_URL, {
          method: 'POST',
          body: JSON.stringify(payload),
          headers: { 'Content-Type': 'application/json' }
        });

        const answer = await res.json();
        if (answer.status === 'ok') {
          showToast('Savings goal added!');
          closeModal();
          await loadFromGoogleSheet(); // refresh tables
        } else {
          throw new Error(answer.message || 'Server error');
        }
      } catch (err) {
        console.error(err);
        showToast('Failed to save goal', 'error');
        btn.textContent = 'Save';
        btn.disabled = false;
      } finally {
        isLoading = false;
      }
    }

    function editSavings(id) {
      const item = allData.find(d => d.__backendId === id);
      if (!item) return;
      
      showModal(`
        <h3 class="heading-font text-xl font-bold text-teal-800 mb-4">Update Savings</h3>
        <form onsubmit="updateSavingsAmount(event, '${id}')">
          <div class="space-y-4">
            <p class="text-teal-700 font-medium">${item.name}</p>
            <div class="bg-teal-50 rounded-xl p-4">
              <p class="text-sm text-teal-600">Target: ${formatCurrency(item.target)}</p>
              <p class="text-sm text-teal-600">Currently Saved: ${formatCurrency(item.saved)}</p>
            </div>
            <div>
              <label class="block text-sm font-medium text-teal-700 mb-1">Add to Savings</label>
              <input type="number" id="add-savings-amount" step="0.01" required class="w-full p-3 rounded-xl border-2 border-teal-200 focus:border-teal-400 focus:outline-none" placeholder="0.00">
            </div>
          </div>
          <div class="flex gap-3 mt-6">
            <button type="button" onclick="closeModal()" class="flex-1 py-3 rounded-xl bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold transition-all">Cancel</button>
            <button type="submit" id="update-savings-btn" class="flex-1 py-3 rounded-xl bg-teal-600 hover:bg-teal-700 text-white font-semibold transition-all">Add</button>
          </div>
        </form>
      `);
    }

            
          async function updateSavingsAmount(e, id) {
        e.preventDefault();
        if (isLoading) return;

        isLoading = true;
        const btn = document.getElementById('update-savings-btn');
        btn.textContent = 'Saving...';
        btn.disabled = true;

        // locate the goal
        const item = allData.find(d => d.__backendId === id);
        if (!item) return;

        const addAmount = parseFloat(document.getElementById('add-savings-amount').value) || 0;
        const updated = {
          ...item,
          saved: (item.saved || 0) + addAmount
        };

        try {
          // send updated row to Google Sheets
          const res = await fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(updated),
            headers: { 'Content-Type': 'application/json' }
          });

          const ans = await res.json();
          if (ans.status !== 'ok') throw new Error(ans.message || 'Server error');

          showToast('Savings updated!');
          closeModal();
          await loadFromGoogleSheet(); // refresh
        } catch (err) {
          console.error(err);
          showToast('Failed to update savings', 'error');
          btn.textContent = 'Add';
          btn.disabled = false;
        } finally {
          isLoading = false;
        }
      }

    
        async function saveNotes() {
        if (isLoading) return;

        const notesValue = document.getElementById('monthly-notes').value;
        const monthKey = getMonthKey(currentMonth);
        const existingNotes = allData.find(d => d.type === 'notes' && d.month === monthKey);

        isLoading = true;
        const btn = document.getElementById('save-notes-btn');
        btn.textContent = 'Saving...';
        btn.disabled = true;

        // Build payload
        const payload = {
          type: 'notes',
          notes: notesValue,
          month: monthKey,
          createdAt: existingNotes ? existingNotes.createdAt : new Date().toISOString() // keep same key
        };

        try {
          const res = await fetch(GOOGLE_SCRIPT_URL, {
            method: 'POST',
            body: JSON.stringify(payload),
            headers: { 'Content-Type': 'application/json' }
          });

          const ans = await res.json();
          if (ans.status !== 'ok') throw new Error(ans.message || 'Server error');

          showToast('Notes saved!');
          await loadFromGoogleSheet(); // refresh
        } catch (err) {
          console.error(err);
          showToast('Failed to save notes', 'error');
        } finally {
          isLoading = false;
          btn.textContent = 'Save Notes';
          btn.disabled = false;
        }
      }

        

    // Delete Functions
    function deleteItem(id) {
      pendingDeleteItem = allData.find(d => d.__backendId === id);
      if (pendingDeleteItem) {
        document.getElementById('delete-confirm').classList.remove('hidden');
      }
    }

    function cancelDelete() {
      pendingDeleteItem = null;
      document.getElementById('delete-confirm').classList.add('hidden');
    }

   // REPLACE confirmDelete body with this Google-Sheets version
async function confirmDelete() {
  if (!pendingDeleteItem || isLoading) return;
  isLoading = true;
  const btn = document.getElementById('confirm-delete-btn');
  btn.textContent = 'Deleting...';
  btn.disabled = true;

  // send a row whose *Notes* field is exactly "__DELETE__" ‚Äì we‚Äôll catch it in doPost
  const deletePayload = {
    type: pendingDeleteItem.type,
    name: pendingDeleteItem.name,
    category: pendingDeleteItem.category,
    amount: pendingDeleteItem.amount || 0,
    date: pendingDeleteItem.date || '',
    month: pendingDeleteItem.month,
    notes: '__DELETE__',   // flag for Apps-Script
    createdAt: pendingDeleteItem.createdAt   // unique key
  };

  try {
    const res = await fetch(GOOGLE_SCRIPT_URL, {
      method: 'POST',
      body: JSON.stringify(deletePayload),
      headers: { 'Content-Type': 'application/json' }
    });
    const ans = await res.json();
    if (ans.status === 'ok') {
      showToast('Item deleted');
      await loadFromGoogleSheet();
    } else throw new Error(ans.message);
  } catch (e) {
    console.error(e);
    showToast('Failed to delete item', 'error');
  } finally {
    isLoading = false;
    btn.textContent = 'Delete';
    btn.disabled = false;
    pendingDeleteItem = null;
    document.getElementById('delete-confirm').classList.add('hidden');
  }
}

    // Close modal on backdrop click
    document.getElementById('modal-overlay').addEventListener('click', function(e) {
      if (e.target === this) closeModal();
    });

    // Initialize
    document.getElementById('current-month').textContent = formatMonth(currentMonth);
    initDataSdk();
  </script>
></body>
</html>